# 11.2. Especificaci√≥n de Procesos Batch
## MODULO1:GESTION DE EQUIPOS

# Proceso Batch: Actualizaci√≥n Consolidada del Estado de Equipos

**Objetivo:**
Actualizar autom√°ticamente el `ID_Estado_equipo` en la tabla `EQUIPOS` para reflejar el estado operativo real de cada equipo (Operativo, Fuera de Servicio, o en Mantenimiento), bas√°ndose en la programaci√≥n de mantenimiento y las fechas de salida. Esto asegura la consistencia y precisi√≥n del estado del inventario.

**Datos de Entrada Clave:**
* **`EQUIPOS`**: `ID_EQUIPOS`, `ID_Estado_equipo` (actual), `Fecha_salida`.
* **`PROG_MANTENIMIENTOS`**: `ID_EQUIPOS`, `Fecha_de_inicio`, `Fecha_de_fin` (para mantenimientos activos).
* **(Referencia) `Estado_Equipo`**: Los c√≥digos de estado (`OPE`, `FSE`, `MNT`) deben existir en esta tabla.

**Operaciones Realizadas :**

1.  **Iteraci√≥n por Equipo**: El proceso recorre cada equipo registrado en la tabla `EQUIPOS`.
2.  **Determinaci√≥n de Estado (L√≥gica de Prioridad):** Para cada equipo, se determina su nuevo estado siguiendo estas reglas:
    * **Prioridad Alta: Mantenimiento (`MNT`)**: Si el equipo tiene una programaci√≥n de mantenimiento activa (`Fecha_de_inicio <= FECHA_ACTUAL <= Fecha_de_fin`).
    * **Prioridad Media: Fuera de Servicio (`FSE`)**: Si no est√° en mantenimiento, pero su `Fecha_salida` no es nula y es anterior o igual a la `FECHA_ACTUAL`.
    * **Prioridad Baja: Operativo (`OPE`)**: Si no cumple las condiciones anteriores, se considera operativo.
3.  **Actualizaci√≥n Condicional**: Si el estado determinado es diferente al estado actual del equipo en la base de datos, se actualiza el `ID_Estado_equipo` en la tabla `EQUIPOS`.
4.  **Registro de Historial**: Cada vez que el estado de un equipo cambia, se inserta un nuevo registro en la tabla `Historial_Estado_Equipo` para mantener un seguimiento de la auditor√≠a.

**Salida:**
* **Tabla `EQUIPOS`**: Se actualiza la columna `ID_Estado_equipo` de los equipos cuyo estado haya cambiado.
* **Tabla `Historial_Estado_Equipo`**: Se insertan nuevos registros para documentar todos los cambios de estado ocurridos.
* **Mensajes de Consola**: Se generan mensajes (`NOTICE`) indicando el progreso y las actualizaciones realizadas.
## MODULO 4: RECEPCION

Proceso Batch: Actualizaci√≥n Consolidada del Estado de Recepciones
 Objetivo:
Actualizar autom√°ticamente el id_estado_recepcion de la tabla Recepcion, dependiendo de si ha pasado cierto tiempo desde la fecha_registro y no se ha generado un control de calidad, o si ya se ha generado. Tambi√©n se registra la auditor√≠a en una tabla historial (si la tienes).

‚úÖ L√≥gica de Estado (Ejemplo):
"REG" (Registrado): Cuando reci√©n se crea.

"VENC" (Vencido): Si han pasado m√°s de 3 d√≠as y no tiene control de calidad.

"APRO" (Aprobado): Si se gener√≥ control de calidad y todo es conforme.

 Datos de Entrada Clave:
Tabla Recepcion: id_recepcion, fecha_registro, id_estado_recepcion

Tabla Control_de_calidad: id_recepcion

(Opcional) Tabla Historial_Estado_Recepcion para registrar el cambio.

üì§ Resultado Esperado:
Recepcion.id_estado_recepcion actualizado autom√°ticamente seg√∫n la l√≥gica.

Historial con fecha, nuevo estado y detalle del cambio.

Mensajes NOTICE con el progreso.

## MODULO 6:GESTION DE TRANSPORTE

# Proceso Batch: Actualizaci√≥n del Estado de √ìrdenes de Transporte

**Objetivo:**
Actualizar autom√°ticamente el id_estado_orden en la tabla orden_transporte para reflejar el estado real de finalizaci√≥n de cada orden, con base en la entrega efectiva de todas las gu√≠as asociadas. Esto permite asegurar que las √≥rdenes marcadas como finalizadas lo est√©n de manera objetiva seg√∫n el cumplimiento log√≠stico.

**Datos de Entrada Clave:**
* **`orden_transporte`**: `id_orden_transporte`, `id_estado_orden`, `fecha_finalizado`.
* **`guia_x_orden_transporte`**: `id_orden_transporte`, `id_guia ` (relaci√≥n entre orden y gu√≠a).
* **`informe_entrega`**: `id_guia`, `fecha_entrega` (fecha en que se registra una entrega v√°lida).
* **(Referencia) `Estado_Orden`**: Se asume que 'F' representa el estado Finalizado.

**Operaciones Realizadas :**
1.  **Iteraci√≥n por √ìrdenes**: El proceso recorre todas las √≥rdenes de transporte cuyo estado a√∫n no sea 'F'
2.  **Evaluaci√≥n de Entregas Completas:**
    * Se cuenta cu√°ntas de esas gu√≠as tienen un registro en la tabla informe_entrega con fecha igual o anterior a la fecha actual.
    * Se cuenta cu√°ntas de esas gu√≠as tienen un registro en la tabla informe_entrega con fecha igual o anterior a la fecha actual.
3.  **Condici√≥n de Finalizaci√≥n:** Si el total de gu√≠as coincide exactamente con el n√∫mero de gu√≠as entregadas, se determina que la orden ha sido completada.
4.  **Actualizaci√≥n del Estado:** Si se verifica la condici√≥n anterior, se actualiza el campo id_estado_orden a 'F' y se registra la fecha_finalizado con la fecha actual del sistema.

**Salida:**
* **Tabla `orden_transporte`**: Se actualiza la columna id_estado_orden y fecha_finalizado en las √≥rdenes cuyo estado haya cambiado a finalizado.
* **Mensajes de Consola**: Se generan RAISE NOTICE indicando las √≥rdenes actualizadas y el cierre del proceso.


Sample content for section 11.2.
